# MakeFshared

[![Build Status](https://travis-ci.org/mkatase/MakeFshared.jl.svg?branch=master)](https://travis-ci.org/mkatase/MakeFshared.jl)
[![codecov](https://codecov.io/gh/mkatase/MakeFshared.jl/branch/master/graph/badge.svg)](https://codecov.io/gh/mkatase/MakeFshared.jl)

MakeFshared is a package that introduce how to make and build self-make Fortran shared library and package.

## Development Environment

* Julia 0.7.0 on Fedora 28 (4.18.14-200 on x86_64)
* Julia 1.0.1 on Fedora 28 (4.18.14-200 on x86_64)
* gfortran 8.2.1 on Fedora 28 (4.18.14-200 on x86_64)

The reason is that `BinaryBuilder.jl` and `BinaryProvider.jl` could not install on Julia 1.1-DEV on F28. On Julia 0.7.0 and 1.0.1, `BinaryProvidir.jl` is installed. (`BinaryBuiler.jl` could not installed.)  

## About Fortran Expansion Code
Refer to [here](https://github.com/mkatase/JuliaPractice) for more information about build and check.

```bash
$ mkdir work
$ cd work
$ curl -O https://mkatase.github.io/github-hosted/data/libmakef.tar.gz
$ tar xvfz libmakef.tar.gz 
$ cd libmakef
$ mkdir build
$ cd build/
$ cmake ..
$ cmake --build .
...
$ ./a.out
 === by subroutine
 Hello Subroutine World !!
 === by eins module
           3           4
          12
 === by zwei module
 --- foo
           7
           8
           7          15
 --- moo
           2           4
           2           5
           4           9
```

VERSION 3.11 is cmake_minimum_required in original code, but this tarball is VERSION 3.7.2.

## Hash code
Hash code outputs using `sha256sum` command.

```bash
$ sha256sum libmakef.tar.gz
d33fef76bf8026112b7d441a4038225d679f305eb23fe2dfb5b249ce270eafbe libmakef.tar.gz
```

## Description about deps directory
`deps directory` supports pacakge build command.

* build.jl
    - To describe download path and hash code
* compile.jl
    - main build script for this package
    - call from build.jl
    - this script is the same as the above fortran expansion procedure
* deps.jl
    - auto generated by build.jl if script is passed
    - call from __init__ function in MakeFshared.jl
    - global variable `libextraf` is very important

## How to install

```julia
(v0.7) pkg> add https://github.com/mkatase/MakeFshared.jl.git
...
(v0.7) pkg> build MakeFshared
  Building CMake ──────→ `~/.julia/packages/CMake/yag1A/deps/build.log`
  Building MakeFshared → `~/.julia/packages/MakeCshared/KA7V1/deps/build.log`

(v0.7) pkg> test MakeFshared
   Testing MakeFshared
...
# printout function check
 Hello Subroutine World !!
# calc function in eins module check
# foo function in zwei module check
           3
           5
# moo function in zwei module check
           5           7
           8           9
Test Summary: | Pass  Total
MakeFshared   |   10     10
   Testing MakeFshared tests passed 
```

## Function Detail
## Four functions for Fortran
- printout function: output string (void return)
- calc function: multiplication (subroutine based)
- foo function: 1-dimensional addition (module based)
- moo function: 2-dimensional addition (module based)

## Usage

```julia
julia> printout()
 Hello Subroutine World !!

julia> calc(Int32[3], Int32[4])
12

julia> x = Int32[3]
1-element Array{Int32,1}:
 3

julia> y = Int32[8]
1-element Array{Int32,1}:
 8

julia> foo(x,y)
           3
           8

julia> y[1]
11

julia> a = Int32[3,4]
2-element Array{Int32,1}:
 3
 4

julia> b = Int32[5,8]
2-element Array{Int32,1}:
 5
 8

julia> moo(a, b)
           3           4
           5           8

julia> b
2-element Array{Int32,1}:
  8
 12
```

## Thanks
Refer to the following. Thanks.

* [NLopt.jl](https://github.com/JuliaOpt/NLopt.jl)
